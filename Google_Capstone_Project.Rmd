---
title: Google Capstone Project
output: github_document
html_document:
   self_contained: yes
   toc: yes
   toc_float: yes
---

# Case Study: How Does a Bike-Share Navigate Speedy Success?

# Introduction

#### This case study is apart of the Google Data Analytics Professional certification. The case study is on Cyclist, which is a bikeshare company that details customers trips over a 12 month period (Oct 21-Sep22). The data is made available by Motivate International Inc under this license <https://ride.divvybikes.com/data-license-agreement> . I will follow the 6 steps of data analysis that I learned in this certification. They are Ask, Prepare, Process, Analyze , Share and Act. (A.P.P.A.S.A).

# Scenario

#### I'm a data analyst working in the marketing analyst team at Cyclistic, a bike-share company in Chicago. The company wants to maximize the total of annual members. In order to do this we need to understand how casual riders and annual members use the service differently.

# 1. Ask

# Objective

#### The objective is to analysis how annual members and non-annual members use the service differently. From the analysis and visualization come up with a marketing strategy on how to maximize annual memberships.

# Stakeholders

```         
[] Lily Moreno- Director Of Marketing

[] Cyclistic Executive Team
```

# 2. PREPARE

I have chosen 12 datasets for this project from October 2021 to September 2022. Each dataset shows the details of every ride of the customers of Cyclists.

Tools that will be used for Cleaning, Documentation and Preparation of data for analysis.

I will use R as it is more efficient than spreadsheets as cleaning data will be very time consuming. With R I will be able to not only analysis the data but visualize and do data wrangling as well.

### [1] Check Working Directory

```{r}
getwd()
```

### [2] Install Packages:

```         
Install Required Packages and Libraries
1.tidyverse is used for metapackage of all tidyverse packages
2.lubridate is used for date functions
3.ggplot2 is used for visualization
4.scales is used for values in data frame 
5.dplyr provides a uniform set of verbs, helping to resolve the most frequent data manipulation hurdles
6.janitor is used to examine and clean dirty data
7.readr will be used to read the csv files
8.data.table is used for fast aggregation of large datasets and low latency add/update/remove of columns
```

```{r eval=FALSE, include=FALSE}
install.packages("tidyverse")
install.packages("ggplot2")
install.packages("lubridate")
install.packages("dplyr")
install.packages("readr")
install.packages("janitor")
install.packages("data.table")
install.packages("tidyr")
```

### [3] Load Packages:

```{r}
library(tidyverse)
library(ggplot2)
library(lubridate)
library(dplyr)
library(readr)
library(janitor)
library(data.table)
library(tidyr)
library(knitr)
```

### [4]Load Datasets

```         
I will name each CSV according to their month and year for easier readability.
```

```{r}
Oct21 <- read.csv("/Users/stevennguyen/project/202110-divvy-tripdata.csv")
Nov21<- read.csv("/Users/stevennguyen/project/202111-divvy-tripdata.csv")
Dec21<- read.csv("/Users/stevennguyen/project/202112-divvy-tripdata.csv")
Jan22<- read.csv("/Users/stevennguyen/project/202201-divvy-tripdata.csv")
Feb22<- read.csv("/Users/stevennguyen/project/202202-divvy-tripdata.csv")
Mar22<- read.csv("/Users/stevennguyen/project/202203-divvy-tripdata.csv")
Apr22 <- read.csv("/Users/stevennguyen/project/202204-divvy-tripdata.csv")
May22<- read.csv("/Users/stevennguyen/project/202205-divvy-tripdata.csv")
Jun22<- read.csv("/Users/stevennguyen/project/202206-divvy-tripdata.csv")
Jul22<- read.csv("/Users/stevennguyen/project/202207-divvy-tripdata.csv")
Aug22<- read.csv("/Users/stevennguyen/project/202208-divvy-tripdata.csv")
Sep22<- read.csv("/Users/stevennguyen/project/202209-divvy-tripdata.csv")
```

### [5] Check columns to see if all are consistent

```         
colnames(Oct21)
colnames(Nov21)
colnames(Dec21)
colnames(Jan22)
colnames(Feb22)
colnames(Mar22)
colnames(Apr22)
colnames(May22)
colnames(Jun22)
colnames(Jul22)
colnames(Aug22)
colnames(Sep22)
```

## [6] Check data structures and data types for all data frames

```{r}
str(Oct21)
str(Nov21)
str(Dec21)
str(Jan22)
str(Feb22)
str(Mar22)
str(Apr22)
str(May22)
str(Jun22)
str(Jul22)
str(Aug22)
str(Sep22)
```

# 3.PROCESS

### [7] Now Data is ready to process. I will now bind all the datasets into a single data frame

```{r}
all_trips <- bind_rows(Oct21,Nov21,Dec21,Jan22,Feb22,Mar22,Apr22,May22,Jun22,Jul22,Aug22,Sep22)
```

### [8] Now that the datasets are a single data frame we will check the data structure and data types.

```{r}
str(all_trips)
```

### [9] Analyzing the data I find that "started_at" and "ended_at" are are actually in "char." As "started_at" and ended_at should be in data time datatype.

```{r}
all_trips[['started_at']] <- ymd_hms(all_trips[['started_at']])
all_trips[['ended_at']] <- ymd_hms(all_trips[['ended_at']])
```

### [10] Now we recheck data structure to ensure that the changes have been made

```{r}
str(all_trips)
```

### [11] Now to remove empty columns that are not required.

```{r}
all_trips <- all_trips %>%
select(-c(start_lat:end_lng))
```

### [12] Now I will use glimpse() function to review the changes.

```{r}
glimpse(all_trips)
```

### [13] It's time to rename columns for better readability.

```{r}
all_trips <- all_trips %>%
    rename(ride_type = rideable_type, 
           start_time = started_at,
           end_time = ended_at,
           customer_type = member_casual)
```

### [14] Now I will use the function glimpse() to review changes.

```{r}
glimpse(all_trips)
```

### [15] Now it is time to add new columns that can be used for aggregate functions.

#### Column for day of the week the trip started

```{r}
all_trips$day_of_the_week <- format(as.Date(all_trips$start_time),'%a')
```

#### Column for month when trip started

```{r}
all_trips$month <- format(as.Date(all_trips$start_time),'%b_%y')
```

#### A column for time and day for the trip started will be created. To do this, time element needs to be extracted from start_time. BUT times has to be in POSIXct. Since only times of class POSIXct are supported in ggplot2. There needs to be a 2 step conversion. First the time needs to be converted to a character vector which strips all the date information. Then the time is converted back into POSIXct with today's date. BUT this has no use for us as only the hours and minutes are.

```{r}
all_trips$time <- format(all_trips$start_time, format = "%H:%M")
all_trips$time <- as.POSIXct(all_trips$time, format = "%H:%M")
```

#### Column for trip duration in min.

```{r}
all_trips$trip_duration <- (as.double(difftime(all_trips$end_time, all_trips$start_time)))/60
```

### [16] Now I use the glimpse() function to review the changes.

```{r}
glimpse(all_trips)
```

### [17] Now it is time to check if there is any negative values in the column trip_duration as this may create issues with when we make visualization. And we don't need any trips that were apart of a quality test.

#### Checking for trip lengths that are less than 0

```{r}
nrow(subset(all_trips,trip_duration < 0))
```

#### Checking test rides that were made by company for quality checks

```{r}
nrow(subset(all_trips, start_station_name %like% "TEST"))
nrow(subset(all_trips, start_station_name %like% "test"))
nrow(subset(all_trips, start_station_name %like% "Test"))
```

#### As there are 8845 rows with trip_duration less than 0 mins and 3220 trips that were test rides, we will remove these observations from our dataframe as they contribute to only about 0.3% of the total rows.

### [18] We will create a new dataframe without of these observations without making any changes to the existing dataframe.

#### Remove negative trip duration

```{r}
all_trips_v2 <- all_trips[!(all_trips$trip_duration < 0),]
```

#### Remove Test Rides

```{r}
all_trips_v2<- all_trips_v2[!((all_trips_v2$start_station_name %like% "TEST" | all_trips_v2$start_station_name %like% "Test")),]
```

#### Check Data Frame

```{r}
glimpse(all_trips_v2)
```

### [19] Now it is time to make sure that customer_type has only two distinct values.

#### Checking the count of distinct values

```{r}
table(all_trips_v2$customer_type)
```

#### Aggregating total trip duration by customer type

```{r}
setNames(aggregate(trip_duration ~ customer_type, all_trips_v2, sum), c("customer_type", "total_trip_duration(mins)"))
```

# 4. Analyze

```         
Now the dataframe is ready for descriptive analysis. 
```

### [20] We will now look at the statistical summary of trip_duration for all trips

```{r}
summary(all_trips_v2$trip_duration)
```

### [21] We will now look at the statistical summary of trip_duration by customer_type

```{r}
all_trips_v2 %>%
    group_by(customer_type) %>%
    summarise(min_trip_duration = min(trip_duration),max_trip_duration = max(trip_duration),
              median_trip_duration = median(trip_duration), mean_trip_duration = mean(trip_duration))
```

#### The mean trip duration of member riders is lower than the mean trip duration of all trips, it is exactly the opposite for casual riders, whose mean trip duration is higher than the the mean trip duration of all trips. This tells us that casual riders usually take the bikes out for a longer duration compared to members.

### [22] Now to find the total number of trips by customer type and day of the week.

We need to fix the order for the day_of_the_week and month variable so they will show up in the same sequence in output tables and visualizations

```{r}
all_trips_v2$day_of_the_week <- ordered(all_trips_v2$day_of_the_week, levels=c("Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"))
all_trips_v2$month <- ordered(all_trips_v2$month, levels=c("Oct_21", "Nov_21", "Dec_21", "Jan_22", "Feb_22", "Mar_22", "Apr_22", "May_22", "Jun_22", "Jul_22", "Aug_22", "Sep_22"))
 all_trips_v2 %>% 
  group_by(customer_type, day_of_the_week) %>%  
  summarise(number_of_rides = n(),average_duration_mins = mean(trip_duration)) %>% 
  arrange(customer_type, desc(number_of_rides))
```

# 5.Share

```         
Time to use R to Visualize our data:
```

### [23] We will now visualize Total trips by customer type by the day of the week.

```{r}
all_trips_v2 %>%
  group_by(customer_type, day_of_the_week) %>% 
  summarise(number_of_rides = n()) %>% 
  arrange(customer_type, day_of_the_week)  %>% 
  ggplot(aes(x = day_of_the_week, y = number_of_rides, fill = customer_type)) +
  labs(title ="Total trips by customer type Vs. Day of the week") +
  geom_col(width=0.5, position = position_dodge(width=0.5)) +
  scale_y_continuous(labels = function(x) format(x, scientific = FALSE))
```

```         
[] We can see that more members ride during the weekday than casuals 
[] Casuals ride more than members on the weekday. 
[] Members ride the most during midweek and casuals towards the end of the week
```

### [24] Now to find the average trips by customer type and month

```{r}
unique(all_trips$month)
all_trips_v2 %>% 
  group_by(customer_type, month) %>%  
  summarise(number_of_rides = n(),`average_duration_(mins)` = mean(trip_duration)) %>% 
arrange(customer_type,desc(number_of_rides))
```

### [25] We will now visualize Total trips by customer type by the month.

```{r}
all_trips_v2 %>%  
  group_by(customer_type, month) %>% 
  summarise(number_of_rides = n()) %>% 
  arrange(customer_type, month)  %>% 
  ggplot(aes(x = month, y = number_of_rides, fill = customer_type)) +
  labs(title ="Total trips by customer type Vs. Month") +
  theme(axis.text.x = element_text(angle = 30)) +
  geom_col(width=0.5, position = position_dodge(width=0.5)) +
  scale_y_continuous(labels = function(x) format(x, scientific = FALSE))
```

```         
[] During the winter months both members and casuals number of rides is less than summer and fall months. 
[] Summer months are the most busiest as both customer types ride the most. 
[] Throughout the year members ride more than casuals
[] Members ride more every month than casuals.
```

### [26] We will now visualize average trip duration by customer type on each day of the week.

```{r}
all_trips_v2 %>%  
  group_by(customer_type, day_of_the_week) %>% 
  summarise(average_trip_duration = mean(trip_duration)) %>%
  ggplot(aes(x = day_of_the_week, y = average_trip_duration, fill = customer_type)) +
  geom_col(width=0.5, position = position_dodge(width=0.5)) + 
  labs(title ="Average trip duration by customer type Vs. Day of the week")
```

```         
[] Casuals take longer trips than members 
[] Casuals take the longest trips on the weekend 
[] Members during the weekday trip duration is very constant and increases during the weekend
[] Casuals trip duration starts high on Monday, with not much change from Tuesday-Wednesday and than increasing from Friday to Sunday 
[] Casuals throughout the week take twice as long as members on trips duration 
```

### [27] Now we will visual average trip duration by customer type during each month.

```{r}
all_trips_v2 %>%
group_by(customer_type, month) %>% 
summarise(average_trip_duration = mean(trip_duration)) %>%
ggplot(aes(x = month, y = average_trip_duration, fill = customer_type)) +
geom_col(width=0.5, position = position_dodge(width=0.5)) + 
labs(title ="Average trip duration by customer type Vs. Month") +
theme(axis.text.x = element_text(angle = 30))
```

```         
[] Casuals take twice as long on trips as members throughout the year. 
[] Members take usually take more time in the summer and fall on their trips 
```

### [28] Now we will visualize the demand of bikes over a 24 hour period.

```{all_trips_v2 %>%}
  group_by(customer_type, time) %>% 
  summarise(number_of_trips = n()) %>%
  ggplot(aes(x = time, y = number_of_trips, color = customer_type, group = customer_type)) +
  geom_line() +
  scale_x_datetime(date_breaks = "1 hour", minor_breaks = NULL,
                   date_labels = "%H:%M", expand = c(0,0)) +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title ="Demand over 24 hours of a day", x = "Time of the day")
```

```         
[] Peak time for trips for both is between 5-6pm and then # of trips decreases after every hour
[] # of trips are low from 12-5 am and 10-11 pm 
[] # of trips start increasing after 5am
[] From 7 to 9 am there is a sharp increases in members trip duration 
```

### [29] Now we will visual ride type VS the number of trips by each type of customer

```{r}
all_trips_v2 %>%
  group_by(ride_type, customer_type) %>%
  summarise(number_of_trips = n()) %>%  
  ggplot(aes(x= ride_type, y=number_of_trips, fill= customer_type))+
              geom_bar(stat='identity') +
  scale_y_continuous(labels = function(x) format(x, scientific = FALSE)) +
  labs(title ="Ride type Vs. Number of trips")
```

```         
[] No members used docked bikes.
[] Members took classic and electric bikes more than casuals 
```

### [30] Now we will create a csv file for further analysis or visualization.

```{r}
write.csv(all_trips, "google_capstone_R.csv")
```

# 6. Act

### Key takeaways

```         
[] Casual customers use the bike share services more from Friday-Sunday than weekdays. While members uses the services more consistently during the week. 

[] Casual riders prefer docked bikes than members as no members used docked bikes. Members use more classic bikes and electric bikes than casual. 

[] Casual riders like electric bikes the most followed by classic than docked. 

[] Members prefer classic bikes than electric bikes. 
```

### Recommendations

```         
[] Introduce a “happy hour” format where during the non busy hours especially during the weekend are at a discounted rate this will increase ridership during the slow days and slow times thus increasing ridership. 

[] Introduce a reward base system for memberships like a free ride every 10 rides during a month. Also have special discounts for members. These suggestions will entice members to stay members and casuals to sign up. 

[] Offer a one time discount for casuals to sign up for new membership. 

[] Offer a referral system like once a person refers someone they get X number of rides free.
```
